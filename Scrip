-- Carga de la UI/HUD
local RainbowUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/inmortales-likes-bot/Lua/refs/heads/main/Hud"))()
local hud = RainbowUI:CreateWindow()

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- =========================
-- Variables y utilidades
-- =========================

-- Variables de control de Auto-Ganar
local AUTO_WIN_DELAY = 135 -- 135 segundos
local COOLDOWN_DELAY = 2 -- 2 segundos
local autoWinActive = true -- El sistema inicia activo
local timerRunning = false
local onCooldown = false

-- Variables de control (resto del script)
local teleporting = false
local teleportObjectName = nil
local notifiedNoObjects = false
local notifiedError = false
local TELEPORT_INTERVAL = 0.1 
-- ... (mantener el resto de variables de PICKUPS, STICKERS y PLATAFORMA)
local multiTeleporting = false
local multiCancelRequested = false
local MULTI_TELEPORT_INTERVAL = 2.0 
local multiNotifiedNoObjects = false
local multiNotifiedError = false
local multiPickupSlotNames = {
    "RevealPickupsSteveEagle",
    "RevealPickupsSteveGecko",
    "RevealPickupsSteveMantisShrimp",
    "RevealPickupsSteveSnowLeopard",
}
local stickerTeleporting = false
local stickerCancelRequested = false
local STICKER_TELEPORT_INTERVAL = 2.0 
local stickerNotifiedNoObjects = false
local stickerNotifiedError = false
local stickerPaths = {
    "Stickers.Cheetah.CheckpointNoSticker00A",
    "ActiveStickers.d6001",
    "Stickers.Cheetah.CheckpointNoSticker01A",
    "Stickers.Cheetah.CheckpointNoSticker01B",
    "ActiveStickers.d6002",
    "Stickers.Cheetah.CheckpointNoSticker02A",
    "ActiveStickers.d6003",
    "ActiveStickers.d6004",
    "ActiveStickers.d6005",
    "ActiveStickers.d6006",
    "Stickers.SnowLeopard.CheckpointNoSticker06A",
    "Stickers.SnowLeopard.CheckpointNoSticker06B",
    "ActiveStickers.d6007",
    "Stickers.SnowLeopard.CheckpointNoSticker07A",
    "ActiveStickers.d6008",
    "Stickers.SnowLeopard.CheckpointNoSticker08A",
    "ActiveStickers.d6009",
    "Stickers.SnowLeopard.CheckpointNoSticker09A",
    "ActiveStickers.d6010",
    "ActiveStickers.d6011",
    "ActiveStickers.d6012",
    "Stickers.Eagle.CheckpointNoSticker12A",
    "Stickers.Eagle.CheckpointNoSticker12A",
    "Stickers.Eagle.CheckpointNoSticker12B",
    "ActiveStickers.d6013",
    "Stickers.Eagle.CheckpointNoSticker13A",
    "Stickers.Eagle.CheckpointNoSticker14A",
    "ActiveStickers.d6014",
    "ActiveStickers.d6015",
}
local platform = nil
local platformFollowConn = nil
local platformManualEnabled = false 
local platformForceDisabled = false 
local PLATFORM_SIZE = Vector3.new(6, 1, 6) 
local PLATFORM_TRANSPARENCY = 0.35
local PLATFORM_COLOR = Color3.fromRGB(30, 144, 255) 
local platformYOffset = 0.1 

-- =========================
-- Funciones de PLATAFORMA (Se mantienen sin cambios)
-- =========================
local function destroyPlatform()
    if platformFollowConn then
        pcall(function() platformFollowConn:Disconnect() end)
        platformFollowConn = nil
    end
    if platform and platform.Parent then
        pcall(function() platform:Destroy() end)
    end
    platform = nil
    if hud and hud.Notify then hud:Notify("Plataforma desactivada") end
end
local function createPlatform()
    if platformForceDisabled then return end
    if platform and platform.Parent then return end
    local character = LocalPlayer and LocalPlayer.Character
    if not character then return end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local p = Instance.new("Part")
    p.Name = "TeleportPlatform_" .. tostring(LocalPlayer and LocalPlayer.UserId or "Local")
    p.Size = PLATFORM_SIZE
    p.Anchored = true
    p.CanCollide = true
    p.Transparency = PLATFORM_TRANSPARENCY
    p.Material = Enum.Material.SmoothPlastic
    p.Color = PLATFORM_COLOR
    p.TopSurface = Enum.SurfaceType.Smooth
    p.BottomSurface = Enum.SurfaceType.Smooth
    p.Parent = workspace
    local hrpSizeY = (hrp.Size and hrp.Size.Y) or 2
    local yOffset = (hrpSizeY / 2) + (p.Size.Y / 2) + 0.1
    platformYOffset = yOffset
    p.CFrame = CFrame.new(hrp.Position - Vector3.new(0, yOffset, 0))
    platform = p
    platformFollowConn = RunService.Heartbeat:Connect(function()
        if not LocalPlayer or not LocalPlayer.Character then
            destroyPlatform()
            return
        end
        local curHrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not curHrp then
            destroyPlatform()
            return
        end
        local currentY = platform and platform.Parent and platform.Position.Y or (curHrp.Position.Y - platformYOffset)
        local targetPos = Vector3.new(curHrp.Position.X, currentY, curHrp.Position.Z)
        platform.CFrame = CFrame.new(targetPos)
    end)
    if hud and hud.Notify then hud:Notify("Plataforma activada") end
end
local function updatePlatformState()
    if platformForceDisabled then
        if platform and platform.Parent then
            pcall(destroyPlatform)
        end
        return
    end
    if teleporting or multiTeleporting or stickerTeleporting or platformManualEnabled then
        if not platform or not platform.Parent then
            pcall(createPlatform)
        end
    else
        if platform and platform.Parent then
            pcall(destroyPlatform)
        end
    end
end
if LocalPlayer then
    LocalPlayer.CharacterAdded:Connect(function(char)
        wait(0.1)
        if platform and platform.Parent then
            pcall(destroyPlatform)
            wait(0.05)
            pcall(function()
                if not platformForceDisabled then createPlatform() end
            end)
        end
    end)
end
local function ensurePlatformUnderCharacterInstant()
    if not platform or not platform.Parent then return end
    local character = LocalPlayer and LocalPlayer.Character
    if not character then return end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local yOffset = platformYOffset or (((hrp.Size and hrp.Size.Y) or 2) / 2 + (platform.Size.Y / 2) + 0.1)
    platform.CFrame = CFrame.new(hrp.Position - Vector3.new(0, yOffset, 0))
end


-- =========================
-- NUEVA FUNCI칍N: Auto-Win Teleport
-- =========================
local function autoWinTeleport()
    local player = LocalPlayer
    local success, destination = pcall(function()
        return game.Workspace.Utility.Teleporters.Portal_to_Wc.Portal["Canvas Clouds"]:FindFirstChild("Cylinder")
    end)

    if success and destination then
        pcall(function()
            if player and player.Character and player.Character.PrimaryPart then
                player.Character:SetPrimaryPartCFrame(destination.CFrame)
                pcall(ensurePlatformUnderCharacterInstant)
                hud:Notify("Auto-Ganar: Teletransporte exitoso.")
            end
        end)
    else
        hud:Notify("Auto-Ganar: Destino 'GANAR' no encontrado.")
    end

    -- Iniciar el Cooldown despu칠s de un teletransporte (independientemente del 칠xito)
    timerRunning = false
    onCooldown = true
    spawn(function()
        hud:Notify("Auto-Ganar: Enfriamiento de 2s iniciado.")
        wait(COOLDOWN_DELAY)
        onCooldown = false
        hud:Notify("Auto-Ganar: Listo para detectar el pr칩ximo ciclo.")
    end)
end

-- =========================
-- Detector de Notificaci칩n (L칩gica de Temporizador)
-- =========================
local notifyEvent = RainbowUI:GetNotifyEvent()
if notifyEvent then
    notifyEvent:Connect(function(message)
        -- SOLO se activa si el sistema est치 activo, NO hay temporizador corriendo, y NO est치 en cooldown
        if autoWinActive and not timerRunning and not onCooldown then
            timerRunning = true
            hud:Notify("Auto-Ganar: Temporizador de "..AUTO_WIN_DELAY.."s iniciado.")
            
            spawn(function()
                wait(AUTO_WIN_DELAY)
                
                -- Verificar si el temporizador sigue activo antes de teletransportar
                if timerRunning then
                    autoWinTeleport()
                end
            end)
        end
    end)
end
-- =========================


-- =========================
-- Funciones de teletransporte (Se mantienen sin cambios)
-- =========================
local function teleportToInstance(instance)
    if not instance then return false end
    local targetCFrame = nil
    if instance:IsA("BasePart") then
        targetCFrame = instance.CFrame
    elseif instance:IsA("Model") and instance.PrimaryPart then
        targetCFrame = instance.PrimaryPart.CFrame
    end
    if targetCFrame then
        local success, err = pcall(function()
            local player = LocalPlayer
            if player and player.Character and player.Character.PrimaryPart then
                player.Character:SetPrimaryPartCFrame(targetCFrame)
                pcall(ensurePlatformUnderCharacterInstant)
            end
        end)
        return success
    end
    return false
end
local function teleportToObject(objectName)
    if not objectName then return false end
    local pickupsFolder = game.Workspace:FindFirstChild("Pickups")
    if not pickupsFolder then return false end
    local object = pickupsFolder:FindFirstChild(objectName)
    if not object then return false end
    if object:IsA("Model") and object.PrimaryPart then
        return teleportToInstance(object.PrimaryPart)
    else
        return teleportToInstance(object)
    end
end

-- =========================
-- Bucle BUSCAR (mantiene loop hasta toggle)
-- =========================
local function startTeleportLoop()
    spawn(function()
        while teleporting do
            local found = teleportToObject(teleportObjectName)
            if found then
                if hud and hud.Notify then hud:Notify("Objeto encontrado.") end
                if notifiedNoObjects then notifiedNoObjects = false end
            else
                if not notifiedNoObjects and hud and hud.Notify then
                    hud:Notify("No hay objetos")
                    notifiedNoObjects = true
                end
            end
            wait(TELEPORT_INTERVAL)
        end
        updatePlatformState()
    end)
end
local function toggleTeleporting(objectName)
    if teleporting then
        teleporting = false
        teleportObjectName = nil
        if hud and hud.Notify then hud:Notify("Opci칩n desactivada") end
        notifiedNoObjects = false
        notifiedError = false
    else
        teleportObjectName = objectName
        teleporting = true
        startTeleportLoop()
        if hud and hud.Notify then hud:Notify("B칰squeda activada.") end
    end
    updatePlatformState()
end

-- =========================
-- Bucle PICKUPS (UNA pasada garantizada de primero a 칰ltimo)
-- =========================
local function gatherMultiTargets()
    local targets = {}
    local slotsRoot = workspace:FindFirstChild("PickupSlots")
    if not slotsRoot then return targets end
    for _, slotName in ipairs(multiPickupSlotNames) do
        local slot = slotsRoot:FindFirstChild(slotName)
        if slot then
            local def = slot:FindFirstChild("Default")
            if def then table.insert(targets, def) end
        end
    end
    return targets
end
local function startMultiTeleportOnce()
    spawn(function()
        local targets = gatherMultiTargets()
        if #targets == 0 then
            if not multiNotifiedNoObjects and hud and hud.Notify then
                hud:Notify("No hay pickups disponibles en PickupSlots")
                multiNotifiedNoObjects = true
            end
            multiTeleporting = false
            if hud and hud.Notify then hud:Notify("Ciclo de pickups finalizado.") end
            updatePlatformState()
            return
        else
            if multiNotifiedNoObjects then multiNotifiedNoObjects = false end
        end
        for i = 1, #targets do
            local target = targets[i]
            local ok = false
            local success, err = pcall(function() ok = teleportToInstance(target) end)
            if (not success) or (success and ok == false) then
                if not multiNotifiedError and hud and hud.Notify then
                    hud:Notify("Error o pickup no v치lido en 칤ndice " .. tostring(i))
                    multiNotifiedError = true
                end
            else
                if hud and hud.Notify then
                    hud:Notify("Teletransportado a pickup (" .. tostring(i) .. ")")
                end
                if multiNotifiedError then multiNotifiedError = false end
            end
            wait(MULTI_TELEPORT_INTERVAL)
        end
        multiTeleporting = false
        multiCancelRequested = false
        if hud and hud.Notify then hud:Notify("Ciclo de pickups finalizado.") end
        updatePlatformState()
    end)
end
local function toggleMultiTeleport()
    if multiTeleporting then
        multiCancelRequested = true
        if hud and hud.Notify then hud:Notify("Solicitud de cancelaci칩n recibida.") end
    else
        multiTeleporting = true
        multiCancelRequested = false
        if hud and hud.Notify then hud:Notify("Iniciando pasada de pickups.") end
        startMultiTeleportOnce()
    end
    updatePlatformState()
end

-- =========================
-- Bucle STICKERS (UNA pasada garantizada de primero a 칰ltimo)
-- =========================
local function findNodeByPath(path)
    local node = workspace
    for seg in string.gmatch(path, "[^%.]+") do
        if node then node = node:FindFirstChild(seg) else break end
    end
    return node
end
local function gatherStickerTargets()
    local targets = {}
    for _, relPath in ipairs(stickerPaths) do
        local node = findNodeByPath(relPath)
        if node then
            local touch = node:FindFirstChild("Touch")
            if touch then table.insert(targets, touch) end
        end
    end
    return targets
end
local function startStickerTeleportOnce()
    spawn(function()
        local targets = gatherStickerTargets()
        if #targets == 0 then
            if not stickerNotifiedNoObjects and hud and hud.Notify then
                hud:Notify("No hay stickers disponibles")
                stickerNotifiedNoObjects = true
            end
            stickerTeleporting = false
            if hud and hud.Notify then hud:Notify("Ciclo de stickers finalizado.") end
            updatePlatformState()
            return
        else
            if stickerNotifiedNoObjects then stickerNotifiedNoObjects = false end
        end
        for i = 1, #targets do
            local target = targets[i]
            local ok = false
            local success, err = pcall(function() ok = teleportToInstance(target) end)
            if (not success) or (success and ok == false) then
                if not stickerNotifiedError and hud and hud.Notify then
                    hud:Notify("Error o sticker no v치lido en 칤ndice " .. tostring(i))
                    stickerNotifiedError = true
                end
            else
                if hud and hud.Notify then
                    hud:Notify("Teletransportado a sticker (" .. tostring(i) .. ")")
                end
                if stickerNotifiedError then stickerNotifiedError = false end
            end
            wait(STICKER_TELEPORT_INTERVAL)
        end
        stickerTeleporting = false
        stickerCancelRequested = false
        if hud and hud.Notify then hud:Notify("Ciclo de stickers finalizado.") end
        updatePlatformState()
    end)
end
local function toggleStickerTeleport()
    if stickerTeleporting then
        stickerCancelRequested = true
        if hud and hud.Notify then hud:Notify("Solicitud de cancelaci칩n recibida.") end
    else
        stickerTeleporting = true
        stickerCancelRequested = false
        if hud and hud.Notify then hud:Notify("Iniciando pasada de stickers.") end
        startStickerTeleportOnce()
    end
    updatePlatformState()
end

-- =========================
-- Botones en la UI (SIN BOT칍N GANAR)
-- =========================

hud:AddButton("BUSCAR 游댍", function()
    local objectNames = {"Default"} 
    local firstObjectName = objectNames[1]
    toggleTeleporting(firstObjectName)
end)

hud:AddButton("CICLO PICKUPS 游대", function()
    toggleMultiTeleport()
end)

hud:AddButton("CICLO STICKERS 游대", function()
    toggleStickerTeleport()
end)

hud:AddButton("PLATAFORMA 游릱", function()
    if not platformManualEnabled then
        platformManualEnabled = true
        platformForceDisabled = false
        pcall(createPlatform)
        if hud and hud.Notify then hud:Notify("Plataforma manual: ON") end
    else
        platformManualEnabled = false
        platformForceDisabled = true
        pcall(destroyPlatform)
        if hud and hud.Notify then hud:Notify("Plataforma manual: OFF (forzada)") end
    end
    updatePlatformState()
end)
