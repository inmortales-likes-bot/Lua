--[[
  游 SCRIPT 游땓 LUIS - LIBRARY GUI BASE
  HUD oscuro, movible y secciones colapsables con scroll.
  Exporta: _G.LuaLibrary
--]]

local SCRIPT_NAME = "SCRIPT 游땓 LUIS"
local LIBRARY_WIDTH = 250    -- Ancho del HUD
local SECTION_MAX_HEIGHT = 200 -- Altura m치xima expandida (scroll)

local LibraryGUI = {}
LibraryGUI.__index = LibraryGUI

function LibraryGUI.new()
    local self = setmetatable({}, LibraryGUI)

    -- Crea el GUI en PlayerGui
    local Player = game.Players.LocalPlayer
    self.ScreenGui = Instance.new("ScreenGui")
    self.ScreenGui.Name = "Library_GUI_Root"
    self.ScreenGui.Parent = Player:WaitForChild("PlayerGui")

    -- Marco Principal (HUD)
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, LIBRARY_WIDTH, 0, 30)
    mainFrame.Position = UDim2.new(0.05, 0, 0.5, -15)
    mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    mainFrame.BorderColor3 = Color3.fromRGB(0, 0, 0)
    mainFrame.BorderSizePixel = 1
    mainFrame.Active = true
    mainFrame.Draggable = true
    mainFrame.Parent = self.ScreenGui
    self.MainFrame = mainFrame

    -- Layout Principal
    local listLayout = Instance.new("UIListLayout")
    listLayout.Name = "MainLayout"
    listLayout.Padding = UDim.new(0, 2)
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Parent = mainFrame

    -- Ajusta el tama침o del MainFrame seg칰n contenido
    local function updateFrameSize()
        mainFrame.Size = UDim2.new(0, LIBRARY_WIDTH, 0, listLayout.AbsoluteContentSize.Y + 2)
    end
    listLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateFrameSize)
    listLayout.ChildAdded:Connect(updateFrameSize)
    listLayout.ChildRemoved:Connect(updateFrameSize)

    -- Encabezado (T칤tulo)
    local header = Instance.new("Frame")
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, 30)
    header.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    header.Parent = mainFrame

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, 0, 1, 0)
    titleLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    titleLabel.BackgroundTransparency = 0.5
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextScaled = true
    titleLabel.Text = SCRIPT_NAME
    titleLabel.Font = Enum.Font.SourceSansBold
    titleLabel.TextSize = 18
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.TextWrapped = true
    titleLabel.Parent = header

    return self
end

-- Agrega una secci칩n colapsable con barra de scroll
function LibraryGUI:addSection(name)
    local mainFrame = self.MainFrame

    local sectionFrame = Instance.new("Frame")
    sectionFrame.Name = name:gsub("%s+", "_") .. "_Section"
    sectionFrame.Size = UDim2.new(1, 0, 0, 30)
    sectionFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    sectionFrame.Parent = mainFrame

    -- Contenedor scrollable
    local contentFrame = Instance.new("ScrollingFrame")
    contentFrame.Name = "Content"
    contentFrame.Size = UDim2.new(1, 0, 0, 0) -- Altura 0: colapsado
    contentFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    contentFrame.BorderSizePixel = 0
    contentFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    contentFrame.ScrollBarThickness = 6
    contentFrame.Parent = sectionFrame

    local contentLayout = Instance.new("UIListLayout")
    contentLayout.Name = "ContentLayout"
    contentLayout.Padding = UDim.new(0, 2)
    contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    contentLayout.Parent = contentFrame

    -- Actualiza el Canvas para el scroll
    local function updateCanvasSize()
        local contentSizeY = contentLayout.AbsoluteContentSize.Y
        contentFrame.CanvasSize = UDim2.new(0, 0, 0, contentSizeY)
    end
    contentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvasSize)
    contentLayout.ChildAdded:Connect(updateCanvasSize)
    contentLayout.ChildRemoved:Connect(updateCanvasSize)

    -- Header de la secci칩n (colapsar/expandir)
    local sectionHeader = Instance.new("TextButton")
    sectionHeader.Name = "SectionHeader"
    sectionHeader.Size = UDim2.new(1, 0, 0, 30)
    sectionHeader.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    sectionHeader.TextColor3 = Color3.fromRGB(200, 200, 200)
    sectionHeader.Text = name .. "  v"
    sectionHeader.Font = Enum.Font.SourceSans
    sectionHeader.TextSize = 16
    sectionHeader.TextXAlignment = Enum.TextXAlignment.Left
    sectionHeader.Parent = sectionFrame

    local isExpanded = false
    sectionHeader.MouseButton1Click:Connect(function()
        isExpanded = not isExpanded
        if isExpanded then
            contentFrame:TweenSize(UDim2.new(1, 0, 0, SECTION_MAX_HEIGHT), "Out", "Quad", 0.2, true)
            sectionHeader.Text = name .. "  -"
        else
            contentFrame:TweenSize(UDim2.new(1, 0, 0, 0), "Out", "Quad", 0.2, true)
            sectionHeader.Text = name .. "  v"
        end
    end)

    return {
        ContentFrame = contentFrame,
        addButton = function(buttonName, callback)
            local button = Instance.new("TextButton")
            button.Name = buttonName:gsub("%s+", "_")
            button.Size = UDim2.new(1, -12, 0, 25)
            button.Position = UDim2.new(0, 6, 0, 0)
            button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            button.TextColor3 = Color3.fromRGB(255, 255, 255)
            button.Text = buttonName
            button.Font = Enum.Font.SourceSans
            button.TextSize = 14
            button.Parent = contentFrame
            if type(callback) == "function" then
                button.MouseButton1Click:Connect(callback)
            end
            updateCanvasSize()
            return button
        end,
        getFrame = function() return sectionFrame end,
    }
end

-- Exporta la librer칤a
_G.LuaLibrary = LibraryGUI
